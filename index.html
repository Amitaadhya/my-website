<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Amit Chaudhary | Radnik Hub</title>
  <link rel="icon" href="https://i.postimg.cc/sXPJH9xd/Screenshot-2025-06-19-143219.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    :root {
      --transition-speed: 0.4s;
      --border-radius-main: 12px;
    }
    
    [data-theme="dark"] {
      --primary: #22d3ee; --primary-dark: #06b6d4; --primary-glow: rgba(34, 211, 238, 0.2);
      --secondary: #f471b5; --secondary-dark: #db2777;
      --bg-main: #0f172a; --bg-content: #1e293b; --bg-elevated: #334155;
      --bg-glass: rgba(30, 41, 59, 0.6);
      --border-color: #475569; --text-light: #f1f5f9; --text-muted: #94a3b8;
      --success: #10b981; --danger: #f43f5e;
      --card-shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    [data-theme="light"] {
      --primary: #0891b2; --primary-dark: #0e7490; --primary-glow: rgba(8, 145, 178, 0.2);
      --secondary: #db2777; --secondary-dark: #be185d;
      --bg-main: #f0f9ff; --bg-content: #ffffff; --bg-elevated: #f8fafc;
      --bg-glass: rgba(255, 255, 255, 0.6);
      --border-color: #e2e8f0; --text-light: #1e293b; --text-muted: #64748b;
      --success: #059669; --danger: #ef4444;
      --card-shadow: 0 10px 25px rgba(0,0,0,0.05);
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Poppins', sans-serif; background-color: var(--bg-main);
      color: var(--text-light); line-height: 1.6; overflow-x: hidden;
      transition: background-color var(--transition-speed), color var(--transition-speed);
    }
    
    .aurora-bg {
      position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
      z-index: -1; overflow: hidden;
    }
    .aurora-bg::before, .aurora-bg::after {
      content: ''; position: absolute;
      width: 70vw; height: 70vw; max-width: 800px; max-height: 800px;
      border-radius: 50%;
      filter: blur(120px);
      opacity: 0.25;
      animation: aurora-move 30s infinite alternate;
      will-change: transform;
    }
    .aurora-bg::before { background: var(--primary); top: -20%; right: -20%; }
    .aurora-bg::after { background: var(--secondary); bottom: -20%; left: -20%; animation-direction: alternate-reverse; }
    @keyframes aurora-move {
      from { transform: translate(0, 0) rotate(0deg) scale(1); }
      to { transform: translate(100px, 50px) rotate(180deg) scale(1.2); }
    }
    
    #preloader {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: var(--bg-main); z-index: 9999;
      display: flex; justify-content: center; align-items: center;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    #preloader.hidden { opacity: 0; visibility: hidden; }
    .spinner {
      width: 50px; height: 50px;
      border: 4px solid var(--border-color);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s ease-in-out infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    @keyframes slideInUp { from { opacity: 0; transform: translateY(25px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
    @keyframes cascadeIn { from { opacity: 0; transform: translateY(20px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    
    /* Login Screen */
    .login-container {
      display: flex; min-height: 100vh; width: 100%; position: fixed;
      top: 0; left: 0; z-index: 2000;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    .login-container.hidden { opacity: 0; visibility: hidden; }
    .login-wrapper {
      margin: auto; display: flex;
      width: 90%; max-width: 900px;
      background: var(--bg-glass);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.3);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      overflow: hidden;
      animation: slideInUp 0.7s ease-out;
    }
    .login-branding {
      width: 45%; padding: 50px; display: flex; flex-direction: column; 
      justify-content: center; text-align: center;
      background: linear-gradient(160deg, var(--primary), var(--primary-dark));
      color: white;
    }
    .login-branding .logo-img { width: 90px; height: 90px; border-radius: 50%; border: 3px solid white; margin: 0 auto 20px; }
    .login-branding h1 { font-size: 2rem; }
    .login-branding p { font-size: 1rem; margin-top: 10px; opacity: 0.9; }
    .login-form-wrapper { width: 55%; padding: 50px; }
    .login-form .input-group { position: relative; margin-bottom: 25px; }
    .login-form .input-group input, .modal .input-group input, .modal .input-group textarea, .modal .input-group select {
        width: 100%; padding: 14px 20px; background: var(--bg-main);
        border: 1px solid var(--border-color); border-radius: var(--border-radius-main);
        color: var(--text-light); transition: all 0.3s ease;
    }
    .login-form .input-group i { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }
    .login-form .input-group input { padding-left: 50px; }
    .login-form .input-group input:focus, .modal .input-group input:focus, .modal .input-group textarea:focus { 
        outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-glow); 
    }
    .login-form .input-group input:focus + i { color: var(--primary); }
    .login-btn, .action-btn {
        width: 100%; padding: 15px;
        background: linear-gradient(90deg, var(--primary), var(--primary-dark));
        color: #fff; border: none; border-radius: var(--border-radius-main);
        font-size: 1.1rem; font-weight: 600; cursor: pointer;
        transition: all 0.3s ease;
    }
    .login-btn:hover, .action-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px var(--primary-glow); }
    .action-btn.danger { background: linear-gradient(90deg, var(--secondary), var(--danger)); }
    .action-btn.danger:hover { box-shadow: 0 8px 25px rgba(244, 63, 94, 0.3); }

    /* Portal View */
    .portal-view { display: none; }
    .portal-view.visible { display: block; animation: slideInUp 0.6s ease-out; }
    
    /* Sidebar */
    .sidebar {
      position: fixed; top: 0; left: 0; width: 260px; height: 100vh; z-index: 1000;
      background: var(--bg-glass);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border-right: 1px solid var(--border-color);
      display: flex; flex-direction: column; padding: 20px;
      transform: translateX(-100%); transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1);
    }
    .sidebar.open { transform: translateX(0); }
    .sidebar .logo { display: flex; align-items: center; gap: 12px; margin-bottom: 30px; }
    .sidebar-nav { flex-grow: 1; list-style: none; }
    .sidebar-nav-item a {
      display: flex; align-items: center; padding: 12px 15px; margin-bottom: 8px;
      color: var(--text-muted); text-decoration: none; border-radius: 8px;
      transition: all 0.3s ease; font-weight: 500; cursor: pointer;
    }
    .sidebar-nav-item a:hover { background-color: var(--bg-elevated); color: var(--text-light); }
    .sidebar-nav-item a.active {
        background-color: var(--primary); color: white; font-weight: 600;
        box-shadow: 0 5px 20px var(--primary-glow);
    }
    .sidebar-footer { padding-top: 20px; border-top: 1px solid var(--border-color); }
    .user-profile {
        display: flex; align-items: center; gap: 12px;
        padding: 10px; border-radius: var(--border-radius-main);
        transition: background 0.3s, box-shadow 0.3s;
    }
    .user-profile:hover { background: var(--bg-elevated); box-shadow: 0 0 15px rgba(0,0,0,0.2); }
    .logout-link:hover { color: var(--danger); }
    
    /* Main Content */
    .main-content { margin-left: 0; padding: 30px; transition: margin-left 0.5s cubic-bezier(0.25, 1, 0.5, 1); }
    body.sidebar-active .main-content { margin-left: 260px; }
    .main-header {
      position: sticky; top: 0; padding: 20px;
      margin: -30px -30px 30px -30px; z-index: 990;
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }
    .main-header.scrolled { background: var(--bg-glass); border-bottom: 1px solid var(--border-color); }
    #menuToggle { display: none; background: none; border: none; color: var(--text-light); font-size: 1.5rem; cursor: pointer; }
    
    /* Dashboard */
    .dashboard-welcome {
      padding: 25px; margin-bottom: 30px;
      background: var(--bg-content);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-main);
      box-shadow: var(--card-shadow);
      animation: cascadeIn 0.5s ease-out forwards;
    }

    /* Search & Filter */
    .search-filter-container {
      display: flex; gap: 15px; margin-bottom: 30px;
      flex-wrap: wrap;
    }
    .search-box {
      flex: 1; min-width: 250px; position: relative;
    }
    .search-box input {
      width: 100%; padding: 14px 20px 14px 45px;
      background: var(--bg-content);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-main);
      color: var(--text-light);
      transition: all 0.3s ease;
    }
    .search-box input:focus {
      outline: none; border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-glow);
    }
    .search-box i {
      position: absolute; left: 18px; top: 50%;
      transform: translateY(-50%); color: var(--text-muted);
    }
    .filter-dropdown {
      min-width: 180px;
    }
    .filter-dropdown select {
      width: 100%; padding: 14px 20px;
      background: var(--bg-content);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius-main);
      color: var(--text-light);
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 15px center;
      background-size: 16px;
    }
    .filter-dropdown select:focus {
      outline: none; border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-glow);
    }
    
    /* Button Grid */
    .button-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
      gap: 20px; 
    }
    .btn {
      display: flex; align-items: center; padding: 15px 20px;
      background: var(--bg-content); border: 1px solid var(--border-color);
      border-radius: var(--border-radius-main); text-decoration: none; color: var(--text-light);
      font-weight: 500; cursor: pointer; transition: all 0.3s ease;
      opacity: 0; animation: cascadeIn 0.5s ease-out forwards;
      box-shadow: var(--card-shadow);
    }
    .btn i:first-child { margin-right: 12px; font-size: 1.2rem; color: var(--primary); transition: transform 0.3s, color 0.3s; }
    .btn:hover {
      transform: translateY(-5px); border-color: var(--primary);
      box-shadow: 0 10px 25px var(--primary-glow);
    }
    .btn:hover i:first-child { transform: scale(1.1); color: var(--secondary); }
    
    /* No Results */
    .no-results {
      grid-column: 1 / -1;
      text-align: center; padding: 40px;
      color: var(--text-muted); font-style: italic;
    }
    
    /* Modals */
    .modal {
      display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.7); backdrop-filter: blur(5px); animation: fadeIn 0.3s;
    }
    .modal-content {
      background: var(--bg-content); margin: 5% auto; padding: 25px;
      border: 1px solid var(--border-color); border-radius: 15px; width: 90%;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5); animation: slideInUp 0.4s;
    }
    .modal-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); }
    #userManagementModal .modal-content { max-width: 800px; }
    .close-btn { font-size: 1.8rem; font-weight: bold; cursor: pointer; }
    .close-btn:hover, .close-btn:focus { color: var(--danger); }
    #permissionsList { max-height: 250px; overflow-y: auto; padding: 10px; background: var(--bg-main); border-radius: 8px; }
    .permission-item { display: flex; align-items: center; gap: 8px; padding: 8px; }
    
    /* Responsive */
    @media (max-width: 992px) {
      .login-branding { display: none; }
      .login-wrapper { width: 90%; max-width: 450px; flex-direction: column; }
      .login-form-wrapper { width: 100%; padding: 40px; }
      body.sidebar-active .main-content { margin-left: 0; }
      #menuToggle { display: block; }
      .search-filter-container { flex-direction: column; }
      .search-box, .filter-dropdown { min-width: 100%; }
    }
    
    @media (max-width: 768px) {
      .button-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="aurora-bg"></div>
  <div id="preloader"><div class="spinner"></div></div>

  <!-- LOGIN PAGE -->
  <div class="login-container" id="loginContainer">
    <div class="login-wrapper">
      <div class="login-branding">
        <img src="https://i.postimg.cc/sXPJH9xd/Screenshot-2025-06-19-143219.png" alt="Portal Logo" class="logo-img">
        <h1>Amit Chaudhary</h1>
        <p>Radnik Exports Data & Resource Hub</p>
      </div>
      <div class="login-form-wrapper">
        <div class="login-form">
          <h2>Welcome Back!</h2>
          <p class="subtitle" style="color: var(--text-muted)">Please sign in to your account.</p>
          <div class="input-group">
            <input type="text" id="username" placeholder="Username" required>
            <i class="fas fa-user"></i>
          </div>
          <div class="input-group">
            <input type="password" id="password" placeholder="Password" required>
            <i class="fas fa-lock"></i>
          </div>
          <button class="login-btn" id="loginBtn"><i class="fas fa-sign-in-alt"></i> &nbsp; Log In</button>
          <p class="subtitle" id="errorMessage" style="text-align:center; color: var(--danger); margin-top: 15px; display:none;"></p>
        </div>
      </div>
    </div>
  </div>

  <!-- PORTAL VIEW (Hidden by default) -->
  <div class="portal-view" id="portalView">
    <nav class="sidebar" id="sidebar">
      <div class="logo"><i class="fas fa-cubes-stacked"></i><h1>Amit Chaudhary</h1></div>
      <ul class="sidebar-nav">
        <li class="sidebar-nav-item"><a id="dashboardLink" class="active"><i class="fas fa-th-large"></i> Dashboard</a></li>
        <li class="sidebar-nav-item"><a id="myProfileBtnSidebar"><i class="fas fa-user-cog"></i> My Profile</a></li>
        <li class="sidebar-nav-item"><a id="notepadBtnSidebar"><i class="fas fa-sticky-note"></i> Notepad</a></li>
        <li class="sidebar-nav-item admin-only" style="display: none;"><a id="userManagementBtnSidebar"><i class="fas fa-users-cog"></i> User Management</a></li>
        <li class="sidebar-nav-item admin-only" style="display: none;"><a id="portalSettingsBtnSidebar"><i class="fas fa-cogs"></i> Portal Settings</a></li>
      </ul>
      <div class="sidebar-footer">
        <div class="user-profile" id="userProfile" style="display: none;">
          <img id="userProfilePic" src="" alt="User" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
          <div>
            <span id="userNameText" style="font-weight: 500;"></span>
            <a class="logout-link" id="logoutLink" style="font-size: 0.8rem; color: var(--text-muted); cursor: pointer;"><i class="fas fa-sign-out-alt"></i> Logout</a>
          </div>
        </div>
      </div>
    </nav>

    <main class="main-content" id="mainContent">
      <header class="main-header" id="mainHeader">
        <div style="display:flex; justify-content: space-between; align-items:center;">
            <div style="display:flex; align-items:center; gap: 15px;">
                <button id="menuToggle"><i class="fas fa-bars"></i></button>
                <h2>Dashboard</h2>
            </div>
            <p id="clock" style="color: var(--text-muted);"></p>
        </div>
      </header>
      
      <div class="dashboard-welcome">
        <h2 id="welcomeMessage"></h2>
        <p style="color: var(--text-muted)">Here are your quick access links and tools.</p>
      </div>
      
      <!-- Search and Filter Section -->
      <div class="search-filter-container">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" id="searchInput" placeholder="Search tools and resources...">
        </div>
        <div class="filter-dropdown">
          <select id="categoryFilter">
            <option value="all">All Categories</option>
            <!-- Categories will be dynamically populated -->
          </select>
        </div>
      </div>
      
      <div class="button-grid" id="buttonContainer">
          <!-- Buttons will be dynamically populated here -->
      </div>
    </main>
  </div>
  
  <!-- MODALS -->
  <div id="userProfileModal" class="modal"><div class="modal-content"><div class="modal-header"><h2><i class="fas fa-user-cog"></i> My Profile</h2><span class="close-btn">&times;</span></div><p>My Profile feature coming soon.</p></div></div>
  <div id="notepadModal" class="modal"><div class="modal-content"><div class="modal-header"><h2><i class="fas fa-sticky-note"></i> Notepad</h2><span class="close-btn">&times;</span></div><textarea id="notepadTextarea" style="width:100%; height: 200px; background:var(--bg-main); color:var(--text-light); border-radius:var(--border-radius-main); padding:10px;"></textarea><button class="action-btn" id="saveNotepadBtn" style="margin-top:15px;">Save</button></div></div>
  <div id="userManagementModal" class="modal"><div class="modal-content"><div class="modal-header"><h2><i class="fas fa-users-cog"></i> User Management</h2><span class="close-btn">&times;</span></div><div id="userManagementMessage" style="margin-bottom:15px; display:none; text-align: center;"></div><div style="display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px;"><div style="padding: 15px; background: var(--bg-main); border-radius:var(--border-radius-main);"><h3>Create User</h3><div class="input-group"><input type="text" id="newUsername" placeholder="Username"></div><div class="input-group"><input type="password" id="newPassword" placeholder="Password"></div><button class="action-btn" id="createUserBtn">Create</button></div><div style="padding: 15px; background: var(--bg-main); border-radius:var(--border-radius-main);"><h3>Edit Permissions</h3><div class="input-group"><select id="selectUserForPermissions"><option>-- Select User --</option></select></div><div id="permissionsContainer" style="display:none;"><h4>Button Access:</h4><div id="permissionsList"></div><button class="action-btn" id="savePermissionsBtn" style="margin-top: 20px;">Save Permissions</button><button class="action-btn danger" id="deleteUserBtn" style="margin-top: 10px;" disabled>Delete User</button></div></div></div></div></div>
  <div id="portalSettingsModal" class="modal"><div class="modal-content"><div class="modal-header"><h2><i class="fas fa-cogs"></i> Portal Settings</h2><span class="close-btn">&times;</span></div><p>Portal Settings feature coming soon.</p></div></div>
  
<script>
    // --- STARTUP LOGIC ---
    document.addEventListener('DOMContentLoaded', () => {
        initializeApp();
    });

    // --- STATE & CONSTANTS ---
    const USERS_KEY = 'radnikPortalUsers_v10';
    const PERMISSIONS_KEY = 'radnikPortalPermissions_v10';
    let currentUser = null;
    let allButtons = [];
    let filteredButtons = [];

    // --- BUTTON DATA (Centralized for easy management) ---
    const ALL_BUTTONS_DATA = [
      { id: "noida-tax-invoice", href: "https://docs.google.com/spreadsheets/d/1p1LreGjZFEWSY3qfkbGaWGymDa_3kzwucDH3xHoPzqU/edit", icon: "fas fa-file-invoice-dollar", text: "Noida Tax Invoice Log", category: "Finance" },
      { id: "186-tax-invoice", href: "https://docs.google.com/spreadsheets/d/1clgoSGc3BF6u25v-cumlJMqrCOZYSydWJ_xSAOpe0FE/edit", icon: "fas fa-receipt", text: "186 Tax Invoice Log", category: "Finance" },
      { id: "eway-bill", href: "https://192.168.20.7/vgeinvoice/LoginPage.aspx", icon: "fas fa-truck-fast", text: "E-Way Bill Dashboard", category: "Logistics" },
      { id: "merge-pdf", href: "https://smallpdf.com/merge-pdf", icon: "fas fa-file-pdf", text: "Merge PDF", category: "Tools" },
      { id: "app-365", href: "https://www.office.com/apps/?auth=2", icon: "fab fa-microsoft", text: "Office 365 Apps", category: "Tools" },
      { id: "chargeback-form", href: "https://docs.google.com/forms/d/e/1FAIpQLSfQf5LaxGX8lLr4nN7hPmrL3mpuaFv1uzYMTaIb02IcGFHp5g/viewform", icon: "fas fa-undo-alt", text: "Chargeback Form", category: "Finance" },
      { id: "daily-sale-186", href: "https://radnikexports1-my.sharepoint.com/:x:/r/personal/amit_chaudhary_radnikexports1_onmicrosoft_com/_layouts/15/Doc.aspx?sourcedoc=%7B5DE750E6-1A38-4B42-B02D-44A3D95B2D14%7D&file=Book%206.xlsx&action=editnew", icon: "fas fa-calendar-day", text: "Daily Sale 186", category: "Sales" },
      { id: "dsec16-sale", href: "https://radnikexports1-my.sharepoint.com/:x:/r/personal/amit_chaudhary_radnikexports1_onmicrosoft_com/_layouts/15/Doc.aspx?sourcedoc=%7B866121D0-C91C-4F09-9F0B-909FBB0C2324%7D&file=DAILY%20SALE%20ENTERY%20NOIDA.xlsx&action=default", icon: "fas fa-cash-register", text: "D-S-E-C16 (Noida Sale)", category: "Sales" },
      { id: "noida-order-entry", href: "https://docs.google.com/spreadsheets/d/11RCeL6pUqN8khww5sY_iA_t-mNgrzwQNvV-bRtLKA9s/edit", icon: "fas fa-clipboard-check", text: "Noida Order Entry", category: "Sales" },
      { id: "chargeback-data", href: "https://docs.google.com/spreadsheets/d/1V92jsBq9iTbYnaoaIdmYdbYc9uoFvaimxaYScnHLD7w/edit", icon: "fas fa-hand-holding-usd", text: "Chargeback Data", category: "Finance" },
      { id: "live-graph-quince", href: "https://docs.google.com/spreadsheets/d/17XLwAmZxvmxOaB-DzPIBjuGmb3u_Zxz9_1aGn175yeE/edit", icon: "fas fa-chart-line", text: "Live Graph Quince", category: "Analytics" },
      { id: "quince-2024-sale", href: "https://docs.google.com/spreadsheets/d/1c4VbDj3CCp_Lr2MCpoJXmlp2K9qP6L3pIA0eZq52PDM/edit", icon: "fas fa-database", text: "QUINCE 2024 SALE DATA", category: "Sales" },
      { id: "maersk-stock-data", href: "https://docs.google.com/spreadsheets/d/1sehWq-1kvNwl0qZWOpkhapuk9mam0FjKAoJvHMV9U5o/edit", icon: "fas fa-ship", text: "MAERSK Stock Data", category: "Logistics" },
      { id: "quince-2025-pos", href: "https://docs.google.com/spreadsheets/d/17RWCZ62o2nRvMgZjfi_fZ6AyBQ0YmHNoIp-CCRSxJjg/edit", icon: "fas fa-shopping-cart", text: "QUINCE 2025 POS DATA", category: "Sales" },
      { id: "quince-invoice-summary", href: "https://docs.google.com/spreadsheets/d/1PnetSLtEPxot9N3KlB_ydbzNccAF5qMnDMRmYLo6ZLs/edit", icon: "fas fa-file-invoice", text: "Quince Invoice Summary", category: "Finance" },
      { id: "ggn-sales-overview", href: "https://docs.google.com/spreadsheets/d/1riS3U9aPW7s8SQmqaZkGrb2fHVEdDbJdHxwdygaeKXc/edit", icon: "fas fa-city", text: "Gurugram Sales Overview", category: "Sales" },
      { id: "noida-sales-overview", href: "https://docs.google.com/spreadsheets/d/15Xma9DRkRectWPqUKDQlr5yZQMtCfQ2Bxa_J5vU-Es0/edit", icon: "fas fa-building-user", text: "Noida Sales Overview", category: "Sales" },
      { id: "anish-sir-site", href: "https://sites.google.com/view/bossanishji/", icon: "fas fa-user-tie", text: "Anish Sir's Site", category: "Resources" },
      { id: "amit-chaudhary-site", href: "https://sites.google.com/view/radnikaks/home", icon: "fas fa-user-astronaut", text: "Amit Chaudhary's Site", category: "Resources" },
      { id: "186-qs-view", href: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ_ihmuGBmPjY_SF6zXQe825cL0i3O9FjTod0gVVgjvc9uSU1HrQsSxcGSVRLAUrJA8NjruJPKs7ezi/pubhtml", icon: "fas fa-chart-pie", text: "186-Q-S-VIEW", category: "Analytics" },
      { id: "c16-qs-view", href: "https://docs.google.com/spreadsheets/d/e/2PACX-1vT1MRNcqWJsXyp4gKAq00N2qKmjoNgXkwVCmxH2lBeeitlz0kNfSiY-z1sNK2JTciPN6mzUpF9-G36Z/pubhtml", icon: "fas fa-chart-area", text: "C16-Q-S-VIEW", category: "Analytics" },
      { id: "c16-import-details", href: "https://docs.google.com/spreadsheets/d/1m3q0x9wKoM7Q7EBSCvpCTozbtB0-73xmgOO_Yx0EBAg/edit", icon: "fas fa-file-import", text: "C16-IMPORT DETAILS", category: "Logistics" },
      { id: "ggn-prep-2025", href: "https://docs.google.com/spreadsheets/d/1LZa3JvfEdt-9cdQkEmsEluwurMoDzmsXIyFWNpAcnfs/edit", icon: "fas fa-tasks", text: "GGN-PREPEMENT 2025", category: "Operations" },
      { id: "quince-hk", href: "https://docs.google.com/spreadsheets/d/1l2CnQrl9YEfOFAoiqj82DYwJ-zQWYqCX5HuL87ffRlw/edit", icon: "fas fa-globe-asia", text: "Quince Hong Kong", category: "International" },
      { id: "projection-vs-sales", href: "https://docs.google.com/spreadsheets/d/1QzAuxxuLUz60iWbdiVGzAFDjXY0RSZIda_0VOhbloEU/edit", icon: "fas fa-bullseye", text: "Projection VS Sales Report", category: "Analytics" },
      { id: "quince-order-chart", href: "https://docs.google.com/spreadsheets/d/1JFI22zsy2Pa5d2lq4dcEeCZIg7rqFaBMYPzniBdlhMc/edit", icon: "fas fa-list-ol", text: "QUINCE ORDER CHART", category: "Sales" },
      { id: "projection-vs-actual", href: "https://docs.google.com/spreadsheets/d/1f7bODkOgwvN_i-nWItzn_67IZv0EqXxAqr2v-ZRQ8Vg/edit", icon: "fas fa-project-diagram", text: "PROJECTION VS ACTUAL", category: "Analytics" },
      { id: "quince-sale-hub", href: "https://docs.google.com/spreadsheets/d/1_5-nGWZmyI5WkTSp6muKe7uEhel7DoAzX1oisoBz1Xw/edit", icon: "fas fa-sitemap", text: "Quince Sale All Data Hub", category: "Sales" },
      { id: "po-wise-qty", href: "https://docs.google.com/spreadsheets/d/1bQqiCaiQ_JGN_B-415ftvVgoH9MmaF9A4ydZkkYXS-Q/edit", icon: "fas fa-exchange-alt", text: "PO Wise Qty Send/Sale", category: "Operations" },
      { id: "sales-perf-ggn", href: "https://amitaadhya.github.io/Quincesaleggn/", icon: "fas fa-tachometer-alt", text: "Sales Perf. Dashboard-GGN", category: "Analytics" },
      { id: "sales-perf-noida", href: "https://amitaadhya.github.io/noidaquincesale/", icon: "fas fa-chart-bar", text: "NOIDA-Sales Perf. Dash.", category: "Analytics" },
      { id: "quince-style-value", href: "https://docs.google.com/spreadsheets/d/1GQucVQMxZanFgg27PGDpflR49a6DksezH4Pby2uFu4A/edit", icon: "fas fa-dollar-sign", text: "QUINCE Style Name Wise Value", category: "Analytics" },
      { id: "quince-invoice-summary-2", href: "https://docs.google.com/spreadsheets/d/1PnetSLtEPxot9N3KlB_ydbzNccAF5qMnDMRmYLo6ZLs/edit", icon: "fas fa-file-alt", text: "Quince_Invoice Summary", category: "Finance" },
      { id: "style-analyzer-ggn", href: "https://script.google.com/macros/s/AKfycbwMLk_TuKGtxzLFMxIoLVONqYMS5RRCf3cBqS9zDw/dev", icon: "fas fa-search-dollar", text: "Quince_ Style Analyzer_GGN", category: "Analytics" },
      { id: "style-analyzer-noida", href: "https://script.google.com/macros/s/AKfycbzljj_8OxdNR2AtJqxfTD_oB11YGTdF0MGulyLCvpE/dev", icon: "fas fa-search-location", text: "Quince_ Style Analyzer_NOIDA", category: "Analytics" },
      { id: "quince-shipping-data", href: "https://docs.google.com/spreadsheets/d/1EfFlN6kb_q08R3cWQT_LJfRoSCKvGpS_JkJGZaUMA34/edit", icon: "fas fa-globe-americas", text: "Quince Mexcio & Canada Ship Data", category: "International" },
      { id: "useful-websites", href: "https://www.notion.so/Welcome-to-Amit-Chaudhary-22a7a00d4f9780fe8865e67bf16d2430", icon: "fas fa-star", text: "Most Useful Websites (AKS!)", category: "Resources" },
      { id: "ggn-revenue-chargeback", href: "https://script.google.com/macros/s/AKfycbw6qke8xOhYaqaxcjFOgp-_wtWAwXEAfVqJA8e6-A/dev", icon: "fas fa-file-excel", text: "GGN Revenue & Chargeback Summary", category: "Finance" },
      { id: "noida-revenue-chargeback", href: "https://script.google.com/macros/s/AKfycbw1Dpw--Ar3rNg3IgPn3e32gpUODmv_O12053XHUYc/dev", icon: "far fa-file-excel", text: "NOIDA Revenue & Chargeback Summary", category: "Finance" },
      { id: "payment-management", href: "https://script.google.com/macros/s/AKfycbwEj1e1d0DfYqaTPbDarQTTYiMaiRWOodd5Cu6x4Sc/dev", icon: "fas fa-credit-card", text: "Radnik Q Payment Management", category: "Finance" },
      { id: "quince-po-records", href: "https://docs.google.com/spreadsheets/d/1pcb48pdm_kwASlmRACu1_E3s1_DHcofF5uOx6h4mLXY/edit", icon: "fas fa-archive", text: "QUINCE PO RECORDS", category: "Operations" },
    ];
    
    // --- UTILITY FUNCTIONS ---
    const getFromLocalStorage = (key, def) => { try { return JSON.parse(localStorage.getItem(key)) || def; } catch { return def; } };
    const saveToLocalStorage = (key, data) => localStorage.setItem(key, JSON.stringify(data));
    const simpleHash = s => { if(!s) return ""; let h = 0; for(let i=0;i<s.length;i++) h=(h<<5)-h+s.charCodeAt(i)|0; return "h_"+h.toString(36); };

    // --- DOM ELEMENT REFERENCES ---
    const dom = {};
    
    // --- MAIN APP LOGIC ---
    function initializeApp() {
        // 1. Cache all DOM elements for performance
        cacheDOMElements();
        
        // 2. Setup initial state and listeners
        initDefaultUsers();
        initEventListeners();
        updateClock();
        setInterval(updateClock, 30000);

        // 3. Check for existing session
        const savedUserJson = sessionStorage.getItem('currentUser');
        if (savedUserJson) {
            currentUser = JSON.parse(savedUserJson);
            showPortal();
        }

        // 4. Hide preloader
        setTimeout(() => dom.preloader.classList.add('hidden'), 500);
    }
    
    function cacheDOMElements() {
        const ids = ['preloader', 'loginContainer', 'portalView', 'loginBtn', 'username', 'password', 'errorMessage', 'sidebar', 'mainContent', 'menuToggle', 'logoutLink', 'welcomeMessage', 'userProfile', 'userNameText', 'userProfilePic', 'mainHeader', 'buttonContainer', 'myProfileBtnSidebar', 'notepadBtnSidebar', 'userManagementBtnSidebar', 'portalSettingsBtnSidebar', 'userProfileModal', 'notepadModal', 'userManagementModal', 'portalSettingsModal', 'saveNotepadBtn', 'notepadTextarea', 'createUserBtn', 'newUsername', 'newPassword', 'selectUserForPermissions', 'permissionsContainer', 'permissionsList', 'savePermissionsBtn', 'deleteUserBtn', 'userManagementMessage', 'searchInput', 'categoryFilter'];
        ids.forEach(id => dom[id] = document.getElementById(id));
        dom.closeBtns = document.querySelectorAll('.close-btn');
    }

    function initEventListeners() {
        dom.loginBtn.addEventListener('click', validateLogin);
        dom.password.addEventListener('keypress', e => { if (e.key === 'Enter') validateLogin(); });
        dom.logoutLink.addEventListener('click', logout);
        dom.menuToggle.addEventListener('click', () => { dom.sidebar.classList.toggle('open'); document.body.classList.toggle('sidebar-active'); });
        window.addEventListener('scroll', () => dom.mainHeader.classList.toggle('scrolled', window.scrollY > 10));
        
        // Search and Filter
        dom.searchInput.addEventListener('input', filterButtons);
        dom.categoryFilter.addEventListener('change', filterButtons);
        
        // Modals
        dom.myProfileBtnSidebar.addEventListener('click', () => openModal('userProfileModal'));
        dom.notepadBtnSidebar.addEventListener('click', openNotepad);
        dom.userManagementBtnSidebar.addEventListener('click', openUserManagement);
        dom.portalSettingsBtnSidebar.addEventListener('click', () => openModal('portalSettingsModal'));
        dom.closeBtns.forEach(btn => btn.addEventListener('click', (e) => e.target.closest('.modal').style.display = 'none'));
        
        // Notepad
        dom.saveNotepadBtn.addEventListener('click', saveNotepad);
        
        // User Management
        dom.createUserBtn.addEventListener('click', createUser);
        dom.selectUserForPermissions.addEventListener('change', loadPermissionsForUser);
        dom.savePermissionsBtn.addEventListener('click', savePermissions);
        dom.deleteUserBtn.addEventListener('click', deleteUser);
    }
    
    // --- AUTHENTICATION & UI FLOW ---
    function validateLogin() {
      const username = dom.username.value.trim();
      const password = dom.password.value.trim();
      if (!username || !password) return showLoginMessage('Username & Password required.');

      const users = getFromLocalStorage(USERS_KEY, []);
      const user = users.find(u => u.username.toLowerCase() === username.toLowerCase() && u.password === simpleHash(password));

      if (user) {
        currentUser = user;
        sessionStorage.setItem('currentUser', JSON.stringify(user));
        showPortal();
      } else {
        showLoginMessage('Invalid username or password.');
        dom.loginContainer.querySelector('.login-wrapper').style.animation = 'shake 0.5s';
        setTimeout(() => { dom.loginContainer.querySelector('.login-wrapper').style.animation = ''; }, 500);
      }
    }
    
    function logout() {
      currentUser = null;
      sessionStorage.removeItem('currentUser');
      dom.portalView.classList.remove('visible');
      dom.loginContainer.classList.remove('hidden');
      dom.sidebar.classList.remove('open');
      document.body.classList.remove('sidebar-active');
      dom.username.value = '';
      dom.password.value = '';
    }

    function showPortal() {
      if (!currentUser) return;
      dom.loginContainer.classList.add('hidden');
      dom.portalView.classList.add('visible');
      
      // Update UI with user data
      dom.welcomeMessage.textContent = `Welcome back, ${currentUser.username}!`;
      dom.userNameText.textContent = currentUser.username;
      dom.userProfilePic.src = currentUser.profilePicUrl;
      dom.userProfile.style.display = 'flex';
      
      document.querySelectorAll('.admin-only').forEach(el => el.style.display = currentUser.username.toLowerCase() === 'admin' ? 'block' : 'none');
      populateButtons();
      
      setTimeout(() => { dom.sidebar.classList.add('open'); document.body.classList.add('sidebar-active'); }, 100);
    }
    
    function showLoginMessage(msg) {
      dom.errorMessage.textContent = msg;
      dom.errorMessage.style.display = 'block';
      setTimeout(() => { dom.errorMessage.style.display = 'none'; }, 3000);
    }
    
    function updateClock() {
        const clockEl = document.getElementById('clock');
        if (clockEl) clockEl.innerHTML = `<i class="far fa-clock"></i> ${new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}`;
    }
    
    // --- FEATURE-SPECIFIC FUNCTIONS ---
    function populateButtons() {
        dom.buttonContainer.innerHTML = '';
        const userPermissions = getFromLocalStorage(PERMISSIONS_KEY, {})[currentUser.username] || [];
        const isAdmin = currentUser.username.toLowerCase() === 'admin';
        
        allButtons = isAdmin ? ALL_BUTTONS_DATA : ALL_BUTTONS_DATA.filter(btn => userPermissions.includes(btn.id));
        filteredButtons = [...allButtons];
        
        // Populate category filter
        const categories = [...new Set(allButtons.map(btn => btn.category))].sort();
        dom.categoryFilter.innerHTML = '<option value="all">All Categories</option>';
        categories.forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            dom.categoryFilter.appendChild(option);
        });
        
        renderButtons();
    }
    
    function renderButtons() {
        dom.buttonContainer.innerHTML = '';
        
        if (filteredButtons.length === 0) {
            dom.buttonContainer.innerHTML = '<div class="no-results">No tools found matching your search criteria</div>';
            return;
        }
        
        filteredButtons.forEach((btnData, index) => {
            const btnElement = document.createElement('a');
            btnElement.href = btnData.href;
            btnElement.className = 'btn';
            btnElement.target = '_blank';
            btnElement.style.animationDelay = `${index * 40}ms`;
            btnElement.innerHTML = `
                <i class="${btnData.icon}"></i>
                <div style="flex: 1;">
                    <span class="btn-text">${btnData.text}</span>
                    <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;">${btnData.category}</div>
                </div>
            `;
            dom.buttonContainer.appendChild(btnElement);
        });
    }
    
    function filterButtons() {
        const searchTerm = dom.searchInput.value.toLowerCase();
        const selectedCategory = dom.categoryFilter.value;
        
        filteredButtons = allButtons.filter(btn => {
            const matchesSearch = btn.text.toLowerCase().includes(searchTerm) || 
                                 btn.category.toLowerCase().includes(searchTerm);
            const matchesCategory = selectedCategory === 'all' || btn.category === selectedCategory;
            
            return matchesSearch && matchesCategory;
        });
        
        renderButtons();
    }

    function openModal(modalId) { document.getElementById(modalId).style.display = 'block'; }
    function showUserManagementMessage(msg, type = 'success') {
        dom.userManagementMessage.textContent = msg;
        dom.userManagementMessage.style.color = type === 'success' ? 'var(--success)' : 'var(--danger)';
        dom.userManagementMessage.style.display = 'block';
        setTimeout(() => dom.userManagementMessage.style.display = 'none', 3000);
    }
    
    function openNotepad() {
        dom.notepadTextarea.value = getFromLocalStorage('notepad_' + currentUser.username, '');
        openModal('notepadModal');
    }
    function saveNotepad() {
        saveToLocalStorage('notepad_' + currentUser.username, dom.notepadTextarea.value);
        dom.notepadModal.style.display = 'none';
    }

    function openUserManagement() {
        populateUsersDropdown();
        dom.permissionsContainer.style.display = 'none';
        openModal('userManagementModal');
    }
    function populateUsersDropdown() {
        const users = getFromLocalStorage(USERS_KEY, []);
        dom.selectUserForPermissions.innerHTML = '<option value="">-- Select User --</option>';
        users.filter(u => u.username.toLowerCase() !== 'admin').forEach(u => {
            const option = new Option(u.username, u.username);
            dom.selectUserForPermissions.add(option);
        });
    }
    function createUser() {
        const username = dom.newUsername.value.trim();
        const password = dom.newPassword.value.trim();
        if (!username || !password) return showUserManagementMessage('All fields required', 'error');

        let users = getFromLocalStorage(USERS_KEY, []);
        if (users.some(u => u.username.toLowerCase() === username.toLowerCase())) return showUserManagementMessage('User already exists', 'error');
        
        users.push({ username, password: simpleHash(password), profilePicUrl: 'https://i.pravatar.cc/150?u=' + username });
        saveToLocalStorage(USERS_KEY, users);
        showUserManagementMessage('User created successfully!');
        dom.newUsername.value = '';
        dom.newPassword.value = '';
        populateUsersDropdown();
    }
    function loadPermissionsForUser() {
        const username = dom.selectUserForPermissions.value;
        dom.deleteUserBtn.disabled = !username;
        if (!username) { dom.permissionsContainer.style.display = 'none'; return; }
        
        const allPermissions = getFromLocalStorage(PERMISSIONS_KEY, {});
        const userPermissions = allPermissions[username] || [];
        
        dom.permissionsList.innerHTML = '';
        ALL_BUTTONS_DATA.forEach(btn => {
            const isChecked = userPermissions.includes(btn.id);
            dom.permissionsList.innerHTML += `
                <div class="permission-item">
                    <input type="checkbox" id="perm-${btn.id}" value="${btn.id}" ${isChecked ? 'checked' : ''}>
                    <label for="perm-${btn.id}">${btn.text} <span style="color: var(--text-muted); font-size: 0.8rem;">(${btn.category})</span></label>
                </div>`;
        });
        dom.permissionsContainer.style.display = 'block';
    }
    function savePermissions() {
        const username = dom.selectUserForPermissions.value;
        if (!username) return;

        let allPermissions = getFromLocalStorage(PERMISSIONS_KEY, {});
        const selectedPermissions = Array.from(dom.permissionsList.querySelectorAll('input:checked')).map(input => input.value);
        allPermissions[username] = selectedPermissions;
        saveToLocalStorage(PERMISSIONS_KEY, allPermissions);
        showUserManagementMessage('Permissions saved!');
    }
    function deleteUser() {
        const username = dom.selectUserForPermissions.value;
        if (!username || !confirm(`Are you sure you want to delete user "${username}"? This cannot be undone.`)) return;
        
        let users = getFromLocalStorage(USERS_KEY, []).filter(u => u.username !== username);
        saveToLocalStorage(USERS_KEY, users);

        let allPermissions = getFromLocalStorage(PERMISSIONS_KEY, {});
        delete allPermissions[username];
        saveToLocalStorage(PERMISSIONS_KEY, allPermissions);
        
        showUserManagementMessage('User deleted.');
        populateUsersDropdown();
        dom.permissionsContainer.style.display = 'none';
    }

    // --- INITIAL DATA SETUP ---
    function initDefaultUsers() {
      let users = getFromLocalStorage(USERS_KEY, []);
      const defaultPic = 'https://i.postimg.cc/sXPJH9xd/Screenshot-2025-06-19-143219.png';
      
      const ensureUser = (username, password) => {
        if (!users.some(u => u.username.toLowerCase() === username.toLowerCase())) {
          users.push({ username, password: simpleHash(password), profilePicUrl: defaultPic });
        }
      };
      
      ensureUser('admin', 'aminehu@123');
      ensureUser('amit', 'aminehu@123');
      saveToLocalStorage(USERS_KEY, users);
    }
</script>
</body>
</html>
